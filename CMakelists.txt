cmake_minimum_required(VERSION 3.18)

project(LightMan)

# include
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include/)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/include)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/stb/include)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/stb/src SRC_STB)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/magicenum/include)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/nlohmann/include)

# src TODO remove to be another porject
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR} SRC_TEST)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/ply/include)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/ply/src SRC_PLY)
include_directories(${CMAKE_CURRENT_SOURCE_DIR}/platform/)

# Shared Sources
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src SRC)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/scene SRC_SCENE)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/math SRC_MATH)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/geometry SRC_GEOMETRY)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/objects SRC_OBJECTS)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/engine SRC_ENGINE)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/view SRC_VIEW)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/utils SRC_UTILS)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/camera SRC_CAMERA)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/renderer SRC_RENDERER)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/managers SRC_MANAGER)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/materials SRC_MATERIALS)
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/texture SRC_TEXTURES)


# Cross-Platform:: Platform
set(SRC_PLATFORM "")
aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/backend SRC_PLATFORM)
if(APPLE AND NOT IOS)
    # add platform files
    aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/backend/macos SRC_PLATFORM)
endif()

# Cross-Platform::OpenGL APIs
if(LIGHTMAN_OPENGL)
    if(APPLE OR WIN32 AND NOT IOS)
        add_definitions(-DLIGHTMAN_OPENGL)
        # Using BLUE Load APIS
        set(SRC_OPENGLAPI ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/BlueGL.cpp)
        set(SRC_OPENGLAPI ${SRC_OPENGLAPI} ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/private_BlueGL.h)
        if(APPLE)
            set(SRC_OPENGLAPI ${SRC_OPENGLAPI} ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/BlueGLDarwin.cpp)
            set(SRC_OPENGLAPI ${SRC_OPENGLAPI} ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/BlueGLCoreDarwinUniversalImpl.S)
        elseif(WIN32)
            set(SRC_OPENGLAPI ${SRC_OPENGLAPI} ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/BlueGLWindows.cpp)
            set(SRC_OPENGLAPI ${SRC_OPENGLAPI} ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/bluegl/src/BlueGLCoreWindowsImpl.S)
        endif()

        aux_source_directory(${CMAKE_CURRENT_SOURCE_DIR}/src/backend/opengl SRC_OPENGLCOMMON)
        list(APPEND SRC_OPENGLAPI ${SRC_OPENGLCOMMON})
    endif()
endif()

# Cross-Platform::PlatformHandle
if(APPLE AND NOT IOS)
    # add platform files
    set(SRC_PLATFORMHANDLE ${CMAKE_CURRENT_SOURCE_DIR}/platform/cocoaplatformhandle.mm)
endif()

# flags
# set(CMAKE_CXX_STANDARD 11)
# set(CMAKE_CXX_STANDARD 14)
# magic_enum need to be C++17
set(CMAKE_CXX_STANDARD 17)
include(CheckCXXCompilerFlag)
CHECK_CXX_COMPILER_FLAG("-std=c++11" COMPILER_SUPPORTS_CXX11)
CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)
enable_language(ASM)

# target
# add_library(${PROJECT_NAME} ${Src})
add_executable(${PROJECT_NAME}
    ${SRC_TEST} 
    ${SRC_PLY}
    ${SRC_STB}
    ${SRC}
    ${SRC_SCENE}
    ${SRC_MATH}
    ${SRC_GEOMETRY}
    ${SRC_OBJECTS}
    ${SRC_ENGINE}
    ${SRC_PLATFORM}
    ${SRC_OPENGLAPI}
    ${SRC_VIEW}
    ${SRC_UTILS}
    ${SRC_CAMERA}
    ${SRC_PLATFORMHANDLE}
    ${SRC_RENDERER}
    ${SRC_MANAGER}
    ${SRC_MATERIALS}
    ${SRC_TEXTURES}
)

if(APPLE)
    # add platform dependency
    target_link_libraries(${PROJECT_NAME} PRIVATE "-framework Cocoa")
endif()
